# 小蚁搬运平台自动推送系统

## 系统概述

本系统实现了自动推送小蚁搬运平台代码到远程仓库的功能，具备以下特性：

1. 每天上午11点自动推送代码
2. 遇到问题时持续重试直到成功
3. 完整的日志记录功能
4. 自动处理本地更改的提交

## 文件说明

### 主要脚本

- `auto-push.sh` - 核心推送脚本，负责执行推送操作并在失败时持续重试
- `run-auto-push.sh` - 定时任务脚本，被cron调用执行推送
- `setup-cron-job.sh` - 设置脚本，用于配置cron作业

### 远程仓库配置

系统配置为推送至以下仓库：
- URL: `git@github.com:sunsh80/xiaoyi_saas.git`
- 分支: `main`
- `manual-push-test.sh` - 手动测试脚本，可随时运行测试推送功能

### 日志文件

- `auto-push.log` - 自动推送脚本的日志文件
- `cron-push.log` - cron任务的日志文件

## Cron作业配置

系统已配置以下cron作业：
```
0 11 * * * /bin/bash /Users/sunsh80/Downloads/易工到项目/小蚁搬运/run-auto-push.sh
```

此配置使系统每天上午11:00自动运行推送脚本。

## 功能特点

### 1. 自动推送
- 每天固定时间自动推送代码到远程仓库
- 自动同步远程最新代码以避免冲突

### 2. 持续重试
- 如果推送失败，脚本将持续重试直到成功
- 每次重试间隔30秒，避免过于频繁的请求

### 3. 智能处理
- 自动检测本地更改并提交
- 处理网络连接问题
- 记录详细的日志信息

### 4. 错误处理
- 完善的错误处理机制
- 详细的日志记录
- 优雅的错误恢复

## 使用方法

### 1. 立即测试推送
```bash
bash /Users/sunsh80/Downloads/易工到项目/小蚁搬运/manual-push-test.sh
```

### 2. 查看推送日志
```bash
tail -f /Users/sunsh80/Downloads/易工到项目/小蚁搬运/auto-push.log
```

### 3. 查看定时任务
```bash
crontab -l
```

### 4. 手动运行定时任务脚本
```bash
bash /Users/sunsh80/Downloads/易工到项目/小蚁搬运/run-auto-push.sh
```

## 维护说明

### 检查定时任务状态
系统将每天自动运行推送脚本，无需人工干预。

### 日志维护
日志文件会持续增长，建议定期清理：
```bash
# 清理超过7天的日志
find /Users/sunsh80/Downloads/易工到项目/小蚁搬运/ -name "*.log" -mtime +7 -delete
```

### 修改推送时间
如需修改推送时间，可以编辑cron作业：
```bash
crontab -e
```

## 故障排除

### 1. 推送失败
检查日志文件以确定失败原因：
```bash
tail -n 50 /Users/sunsh80/Downloads/易工到项目/小蚁搬运/auto-push.log
```

### 2. 认证问题
如果遇到认证问题，请确保：
- 已配置正确的Git凭证
- SSH密钥已添加到GitHub账户（如果是用SSH方式）
- Personal Access Token具有适当权限（如果是用HTTPS方式）

### 3. 网络问题
脚本会自动处理临时网络问题，持续重试直到连接恢复。

## 安全说明

- 脚本仅推送代码，不会修改远程仓库的其他内容
- 所有操作都有日志记录，便于审计
- 脚本仅在本地运行，不会泄露敏感信息

## 仓库优化

远程仓库已进行优化，移除了大型依赖文件（如node_modules目录），显著减小了存储空间和下载时间。本地完整版保留所有依赖用于开发，但推送至远程仓库时只推送核心代码文件。

## 技术细节

推送脚本执行以下步骤：
1. 进入仓库目录
2. 拉取远程最新代码
3. 检测并提交本地更改
4. 推送代码到远程仓库
5. 如果失败则等待30秒后重试
6. 成功后退出循环

此系统确保代码始终能成功推送到远程仓库，即使在网络不稳定的情况下也能可靠工作。